<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>Detalles Usuario</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- Bootstrap -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

        <!-- Icons -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

        <!-- SweetAlert -->
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    </head>

    <body class="container">

        <div class="container text-center rounded shadow-sm mt-4">

            <div class="row mb-3 align-items-start">

                <!-- INFORMACIÓN DEL USUARIO -->

                <div class="col">

                    <h3>Información Usuario</h3>

                    <div class="text-center mb-3">
                        <img src="https://static.vecteezy.com/system/resources/thumbnails/022/014/184/small/user-icon-member-login-isolated-vector.jpg"
                             class="rounded" style="max-width: 180px;">
                    </div>


                    <tr th:each="usuario : ${usuario}"></tr>

                    <div th:if="${Usuario != null}">
                        <p th:text="${Usuario.idUsuario}"></p>
                    </div>

                    <div class="row g-3">

                        <!-- ==================== NOMBRE Y APELLIDOS ==================== -->
                        <div class="col-md-4 mb-3">
                            <label class="form-label fw-bold">Nombre</label>
                            <input type="text" class="form-control" placeholder="Nombre"
                                   th:field="${usuario.Nombre}" onkeypress="SoloLetras(event, this)">
                            <span class="text-danger error-msg"></span>
                        </div>

                        <div class="col-md-4 mb-3">
                            <label class="form-label fw-bold">Apellido Paterno</label>
                            <input type="text" class="form-control" placeholder="Apellido Paterno"
                                   th:field="${usuario.ApellidoPaterno}" onkeypress="SoloLetras(event, this)">
                            <span class="text-danger error-msg"></span>
                        </div>

                        <div class="col-md-4 mb-3">
                            <label class="form-label fw-bold">Apellido Materno</label>
                            <input type="text" class="form-control" placeholder="Apellido Materno"
                                   th:field="${usuario.ApellidoMaterno}" onkeypress="SoloLetras(event, this)">
                            <span class="text-danger error-msg"></span>
                        </div>

                        <!-- ==================== USERNAME Y PASSWORD ==================== -->
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-bold">Username</label>
                            <input type="text" class="form-control" placeholder="username"
                                   th:field="${usuario.username}" onkeypress="username(event, this)">
                            <span class="text-danger error-msg"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-bold">Password</label>
                            <input type="password" class="form-control" placeholder="password"
                                   th:field="${usuario.password}" oninput="password(event, this)">
                            <span class="text-danger error-msg"></span>
                        </div>

                        <!-- ==================== CORREO / TELÉFONOS ==================== -->
                        <div class="col-md-4 mb-3">
                            <label class="form-label fw-bold">Correo</label>
                            <input type="email" class="form-control" placeholder="Correo"
                                   th:field="${usuario.Email}" oninput="Email(event, this)">
                            <span class="text-danger error-msg"></span>
                        </div>

                        <div class="col-md-4 mb-3">
                            <label class="form-label fw-bold">Teléfono</label>
                            <input type="text" class="form-control" placeholder="Telefono"
                                   th:field="${usuario.Telefono}" oninput="numeroCT(event, this)">
                            <span class="text-danger error-msg"></span>
                        </div>

                        <div class="col-md-4 mb-3">
                            <label class="form-label fw-bold">Celular</label>
                            <input type="tel" class="form-control" placeholder="Celular"
                                   th:field="${usuario.Celular}" oninput="numeroCT(event, this)">
                            <span class="text-danger error-msg"></span>
                        </div>

                        <!-- ==================== FECHA / CURP / SEXO ==================== -->
                        <div class="col-md-4 mb-3">
                            <label class="form-label fw-bold">Fecha de Nacimiento</label>
                            <input type="date" class="form-control"
                                   th:field="${usuario.fechanacimiento}" onblur="Fecha(event, this)">
                            <span class="text-danger error-msg"></span>
                        </div>

                        <div class="col-md-4 mb-3">
                            <label class="form-label fw-bold">CURP</label>
                            <input type="text" class="form-control" placeholder="Curp"
                                   th:field="${usuario.Curp}" oninput="Curp(event, this)">
                            <span class="text-danger error-msg"></span>
                        </div>

                        <div class="col-md-4 mb-3">
                            <label class="form-label fw-bold d-block">Sexo</label>

                            <div id="sexo" th:field="*{sexo}">
                                <input type="radio" class="btn-check" name="sexo" value="H" id="sexoH">
                                <label class="btn btn-outline-primary" for="sexoH">
                                    <i class="bi bi-person-standing"></i> Hombre
                                </label>

                                <input type="radio" class="btn-check ms-2" name="sexo" value="M" id="sexoM">
                                <label class="btn btn-outline-primary" for="sexoM">
                                    <i class="bi bi-person-standing-dress"></i> Mujer
                                </label>
                            </div>
                        </div>

                        <!-- Button trigger modal -->
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editarUsuario">
                            Editar Datos
                        </button>
                        <!--                        
                                                  BOTÓN 
                                                <div class="col-12 mb-3">
                                                    <a class="btn btn-primary w-100"
                                                       th:href="@{/usuario/formEditable(idUsuario=${usuario.idUsuario})}">
                                                        Editar Información
                                                    </a>
                                                </div>-->

                    </div>

                </div>


                <!--  DIRECCIONES -->

                <div class="col">

                    <h3>Dirección(es)</h3>

                    <table class="table">
                        <thead>
                            <tr>
                                <th scope="col">Calle</th>
                                <th scope="col">Número Interior</th>
                                <th scope="col">Número Exterior</th>
                                <th scope="col">Acciones</th>
                            </tr>
                        </thead>

                        <tbody>

                            <tr th:if="${usuario.Direcciones != null}"
                                th:each="direccion : ${usuario.Direcciones}">
                                <td th:text="${direccion.Calle}"></td>
                                <td th:text="${direccion.NumeroInterior}"></td>
                                <td th:text="${direccion.NumeroExterior}"></td>

                                <td>
                                    <!--                                    <a class="btn btn-warning btn-sm"
                                                                           th:href="@{/usuario/formEditable(idUsuario=${usuario.idUsuario}, IdDireccion=${direccion.IdDireccion})}">
                                                                            Editar
                                                                        </a>-->
                                    <button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#editarDireccion">
                                        Editar Dirección
                                    </button>

                                    <a class="btn btn-danger btn-sm">Borrar</a>
                                </td>
                            </tr>

                            <tr th:unless="${usuario.Direcciones != null}">
                                <td colspan="4">Sin dirección.</td>
                            </tr>

                        </tbody>
                    </table>

                    <div>
                        <!--                        <a class="btn btn-secondary mt-2 col-12"
                                                   th:href="@{/usuario/formEditable(idUsuario=${usuario.idUsuario}, IdDireccion=0)}">
                                                    Agregar Dirección
                                                </a>-->
                        <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#agregarDireccion">
                            Agregar Dirección
                        </button>
                    </div>

                    <input type="hidden" th:field="${usuario.idUsuario}">

                </div>

            </div>


            <!-- Modal editar usuario -->
            <div class="modal fade" id="editarUsuario" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="exampleModalLabel">Editar Usuario</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>

<!--                        <form method="post" th:object="${Usuario}" th:action="@{add}">-->

                   
                            <div class="modal-body">

                                <div class="row g-3">
                                    <!-- ==================== NOMBRE Y APELLIDOS ==================== -->
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label fw-bold">Nombre</label>
                                        <input type="text" class="form-control" placeholder="Nombre"
                                               th:field="${usuario.Nombre}" onkeypress="SoloLetras(event, this)">
                                        <span class="text-danger error-msg"></span>
                                    </div>

                                    <div class="col-md-4 mb-3">
                                        <label class="form-label fw-bold">Apellido Paterno</label>
                                        <input type="text" class="form-control" placeholder="Apellido Paterno"
                                               th:field="${usuario.ApellidoPaterno}" onkeypress="SoloLetras(event, this)">
                                        <span class="text-danger error-msg"></span>
                                    </div>

                                    <div class="col-md-4 mb-3">
                                        <label class="form-label fw-bold">Apellido Materno</label>
                                        <input type="text" class="form-control" placeholder="Apellido Materno"
                                               th:field="${usuario.ApellidoMaterno}" onkeypress="SoloLetras(event, this)">
                                        <span class="text-danger error-msg"></span>
                                    </div>

                                    <!-- ==================== USERNAME Y PASSWORD ==================== -->
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label fw-bold">Username</label>
                                        <input type="text" class="form-control" placeholder="username"
                                               th:field="${usuario.username}" onkeypress="username(event, this)">
                                        <span class="text-danger error-msg"></span>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label fw-bold">Password</label>
                                        <input type="password" class="form-control" placeholder="password"
                                               th:field="${usuario.password}" oninput="password(event, this)">
                                        <span class="text-danger error-msg"></span>
                                    </div>

                                    <!-- ==================== CORREO / TELÉFONOS ==================== -->
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label fw-bold">Correo</label>
                                        <input type="email" class="form-control" placeholder="Correo"
                                               th:field="${usuario.Email}" oninput="Email(event, this)">
                                        <span class="text-danger error-msg"></span>
                                    </div>

                                    <div class="col-md-4 mb-3">
                                        <label class="form-label fw-bold">Teléfono</label>
                                        <input type="text" class="form-control" placeholder="Telefono"
                                               th:field="${usuario.Telefono}" oninput="numeroCT(event, this)">
                                        <span class="text-danger error-msg"></span>
                                    </div>

                                    <div class="col-md-4 mb-3">
                                        <label class="form-label fw-bold">Celular</label>
                                        <input type="tel" class="form-control" placeholder="Celular"
                                               th:field="${usuario.Celular}" oninput="numeroCT(event, this)">
                                        <span class="text-danger error-msg"></span>
                                    </div>

                                    <!-- ==================== FECHA / CURP / SEXO ==================== -->
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label fw-bold">Fecha</label>
                                        <input type="date" class="form-control"
                                               th:field="${usuario.fechanacimiento}" onblur="Fecha(event, this)">
                                        <span class="text-danger error-msg"></span>
                                    </div>

                                    <div class="col-md-4 mb-3">
                                        <label class="form-label fw-bold">Curp</label>
                                        <input type="text" class="form-control" placeholder="Curp"
                                               th:field="${usuario.Curp}" oninput="Curp(event, this)">
                                        <span class="text-danger error-msg"></span>
                                    </div>

                                    <div class="col-md-4 mb-3">
                                        <label class="form-label fw-bold d-block">Sexo</label>

                                        <div id="sexo">
                                            <input type="radio" class="btn-check" name="sexo" value="H" id="sexoH">
                                            <label class="btn btn-outline-primary" for="sexoH">
                                                <i class="bi bi-person-standing"></i> Hombre
                                            </label>

                                            <input type="radio" class="btn-check ms-2" name="sexo" value="M" id="sexoM">
                                            <label class="btn btn-outline-primary" for="sexoM">
                                                <i class="bi bi-person-standing-dress"></i> Mujer
                                            </label>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cerrar</button>
<!--                                <button type="submit" class="btn btn-primary">Editar</button>-->
                                <button th:onclick="|EditarUsu(${usuario.IdUsuario})|" class="btn btn-primary">
                                Editar
                            </button>
                            </div>
<!--                        </form>-->
                    </div>
                </div>
            </div>


            <!-- Modal Agregar Direccion -->
            <div class="modal fade" id="agregarDireccion" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="exampleModalLabel">Agregar Direccion</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">


                            <div class="mb-3">
                                <h5 class="fw-bold text-primary mb-3">
                                    <i class="bi bi-geo-alt-fill"></i> Dirección
                                </h5>

                                <!-- ==================== CALLE / NUMEROS ==================== -->
                                <div class="row g-3">

                                    <div class="col-md-6">
                                        <label class="form-label fw-semibold">Calle</label>
                                        <div class="input-group input-group-sm">
                                            <span class="input-group-text"><i class="bi bi-signpost-split"></i></span>
                                            <input type="text" class="form-control" id="Calle"
                                                   placeholder="Calle">
                                        </div>
                                    </div>

                                    <div class="col-md-3">
                                        <label class="form-label fw-semibold">Número Ext</label>
                                        <div class="input-group input-group-sm">
                                            <span class="input-group-text"><i class="bi bi-hash"></i></span>
                                            <input type="text" class="form-control" id="NumeroExterior"
                                                   placeholder="Exterior">
                                        </div>
                                    </div>

                                    <div class="col-md-3">
                                        <label class="form-label fw-semibold">Número Int</label>
                                        <div class="input-group input-group-sm">
                                            <span class="input-group-text"><i class="bi bi-door-open"></i></span>
                                            <input type="text" class="form-control" id="NumeroInterior"
                                                   placeholder="Interior">
                                        </div>
                                    </div>
                                </div>

                                <!-- ==================== PAÍS / ESTADO / MUNICIPIO / COLONIA ==================== -->
                                <div class="row g-3 mt-2">

                                    <div class="col-md-3">
                                        <label class="form-label fw-semibold">País</label>
                                        <div class="input-group input-group-sm">
                                            <span class="input-group-text"><i class="bi bi-globe-americas"></i></span>
                                            <select id="ddlpais" class="form-select">
                                                <option value="0" selected>Selecciona un país</option>
                                                <option th:each="pais : ${Paises}" th:text="${pais.Nombre}" th:value="${pais.idPais}"></option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="col-md-3">
                                        <label class="form-label fw-semibold">Estado</label>
                                        <div class="input-group input-group-sm">
                                            <span class="input-group-text"><i class="bi bi-map"></i></span>
                                            <select id="ddlestado" class="form-select">
                                                <option value="0" selected>Selecciona un estado</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="col-md-3">
                                        <label class="form-label fw-semibold">Municipio</label>
                                        <div class="input-group input-group-sm">
                                            <span class="input-group-text"><i class="bi bi-map-fill"></i></span>
                                            <select id="ddlmunicipio" class="form-select">
                                                <option value="0" selected>Selecciona un municipio</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="col-md-3">
                                        <label class="form-label fw-semibold">Colonia</label>
                                        <div class="input-group input-group-sm">
                                            <span class="input-group-text"><i class="bi bi-house-door"></i></span>
                                            <select id="ddlcolonia" class="form-select"
                                                    >
                                                <option value="0" selected>Selecciona una colonia</option>
                                            </select>
                                        </div>
                                    </div>

                                </div>
                            </div>



                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cerrar</button>
                            <button type="button" class="btn btn-success" >Agregar</button>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Modal editar Direccion -->
            <div class="modal fade" id="editarDireccion" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="exampleModalLabel">Editar Direccion</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">


                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cerrar</button>
                            <button type="button" class="btn btn-primary">Editar</button>
                        </div>
                    </div>
                </div>
            </div>






        </div>

    </body>

    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script>
//        modal y funcionamiento


            console.log("Boton de eliminar");
            function EditarUsu(IdUsuario) {
            Swal.fire({
            title: "¿Estas seguro de editar el usuario?",
                    text: "El usuario se va a modificar",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#3085d6",
                    cancelButtonColor: "#d33",
                    confirmButtonText: "Si"
            }).then((result) => {
            if (result.isConfirmed) {
            window.location.href = "/usuario/update/" + IdUsuario;
            }
            });
            }


        </script>


   


    <script>

        $(document).ready(function () {

            console.log("iniciando")
            $("#ddlpais").change(function () {
                if ($("#ddlpais").val() == 0) {
                    $("#ddlestado").empty();
                    $("#ddlestado").append("<option value=0 selected>Selecciona un estado</option>");
                } else {
                    console.log("Primer Else")
                    $.ajax({
                        url: "/usuario/getEstadosByPais/" + $("#ddlpais").val(),
                        method: 'GET',
                        dataType: 'json',
                        success: function (data, textStatus, jqXHR) {
                            if (data.Correct) {
                                $("#ddlestado").empty();
                                $("#ddlestado").append("<option value=0 selected>Selecciona un estado</option>");
                                $.each(data.Objects, function (i, estado) {
                                    $("#ddlestado").append("<option value=" + estado.idEstado + ">" + estado.nombre + "</option>");
                                })
                            }
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            alert("Algo salio mal");
                        }

                    })
                }
            });


            $("#ddlestado").change(function () {
                if ($("#ddlestado").val() == 0) {
                    $("#ddlmunicipio").empty();
                    $("#ddlmunicipio").append("<option value=0 selected>Selecciona un municipio</option>");
                } else {
                    console.log("municipio")
                    $.ajax({
                        url: "/usuario/getMunicipioByEstado/" + $("#ddlestado").val(),
                        method: 'GET',
                        dataType: 'json',
                        success: function (data, textStatus, jqXHR) {
                            if (data.Correct) {
                                $("#ddlmunicipio").empty();
                                $("#ddlmunicipio").append("<option value=0 selected>Selecciona un municipio</option>");
                                $.each(data.Objects, function (i, municipio) {
                                    $("#ddlmunicipio").append("<option value=" + municipio.idMunicipio + ">" + municipio.nombre + "</option>");
                                })
                            }
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            alert("Algo salio mal")
                        }

                    })
                }

            });


            $("#ddlmunicipio").change(function () {
                if ($("#ddlmunicipio").val() == 0) {
                    $("#ddlcolonia").empty();
                    $("#ddlcolonia").append("<option value=0 selected>Selecciona una colonia</option>");
                } else {
                    console.log("colonia")
                    $.ajax({
                        url: "/usuario/getColoniaByMunicipio/" + $("#ddlmunicipio").val(),
                        method: 'GET',
                        dataType: 'json',
                        success: function (data, textStatus, jqXHR) {
                            if (data.Correct) {
                                $("#ddlcolonia").empty();
                                $("#ddlcolonia").append("<option value=0 selected>Selecciona una colonia</option>");
                                $.each(data.Objects, function (i, colonia) {
                                    //                                        $("#ddlcolonia").append("<option value=" + colonia.idColonia + ">" + colonia.nombre + "</option>");
                                    $("#ddlcolonia").append('<option value="' + colonia.idColonia + '">' + colonia.nombre + '</option>');

                                })
                            }
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            alert("Algo salio mal")
                        }

                    })
                }

            });

        });

    </script>
    <script>


        function numeroCT(event, input) {
            let key = event.key;
            let RegExp = /^\d{10}$/;
            if (RegExp.test(input.value)) {
                $(input).removeClass("error").addClass("correct");
                $(input).siblings(".error-msg").text("");
            } else {
                $(input).removeClass("correct").addClass("error");
                $(input).siblings(".error-msg").text("Ingresa un número válido");
            }
        }

        function Curp(event, input) {
            let value = input.value;
            let RegExp = /^[A-Z]{4}[0-9]{6}[A-Z]{7}[0-9]{1}$/;
            if (RegExp.test(value)) {
                $(input).removeClass("error").addClass("correct");
                $(input).siblings(".error-msg").text("");
            } else {
                $(input).removeClass("correct").addClass("error");
                $(input).siblings(".error-msg").text("Ingresa una curp valida");
            }
        }

        function SoloLetras(event, input) {
            let key = event.key;
            let RegExp = /[a-zA-Z]+/;
            if (RegExp.test(key)) {
                $(input).removeClass("error").addClass("correct");
                $(input).siblings(".error-msg").text("");
            } else {
                $(input).removeClass("correct").addClass("error");
                $(input).siblings(".error-msg").text("No se permiten numeros");
                event.preventDefault();
            }
        }

        function Email(event, input) {
            let key = event.key;
            let RegExp = /^[^@]+@[^@]+\.[a-zA-Z]{2,}$/;
            if (RegExp.test(input.value)) {
                $(input).removeClass("error").addClass("correct");
                $(input).siblings(".error-msg").text("");
            } else {
                $(input).removeClass("correct").addClass("error");
                $(input).siblings(".error-msg").text("Ingresa un correo valido");
                event.preventDefault();
            }
        }

        function Fecha(event, input) {

            const FechaInput = new Date(input.value);
            const FechaActual = new Date();
            if (FechaInput < FechaActual) {
                $(input).removeClass("error").addClass("correct");
            } else {
                $(input).removeClass("correct").addClass("error");
                $(input).siblings(".error-msg").text("Ingresa una fecha valida");
                event.preventDefault();
            }

        }

        function username(event, input) {
            let key = event.key();
            let RegExp = /\w+/;
            if (RegExp.test(key)) {
                $(input).removeClass("error").addClass("correct");
            } else {
                $(input).removeClass("correct").addClass("error");
                $(input).siblings(".error-msg").text("Ingresa un usuario valido");
                event.preventDefault();
            }

        }

        function password(event, input) {

            let RegExp = /^(?=\w*\d)(?=\w*[A-Z])(?=\w*[a-z])\S{8,}$/;
            if (RegExp.test(input.value)) {

                $(input).removeClass("error").addClass("correct");
                $(input).siblings(".error-msg").text(""); // Limpiar el mensaje de error
            } else {

                $(input).removeClass("correct").addClass("error");
                $(input).siblings(".error-msg").text("Ingresa una contraseña de mínimo 8 dígitos con al menos una mayúscula y número.");
            }
        }

    </script>


</html>
